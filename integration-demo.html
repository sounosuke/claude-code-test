<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced IT Company Website - Interactive Demo</title>
    
    <!-- ğŸš¨ç·Šæ€¥ä¿®æ­£: å …ç‰¢ãªCDNãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ -->
    <!-- WebGazer.js - è¤‡æ•°CDNãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ -->
    <script>
        // WebGazer.jså‹•çš„èª­ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ 
        (function() {
            const webgazerUrls = [
                'https://webgazer.cs.brown.edu/webgazer.js',
                'https://cdn.jsdelivr.net/npm/webgazer@2.0.1/dist/webgazer.min.js',
                'https://unpkg.com/webgazer@latest/dist/webgazer.min.js'
            ];
            
            let currentUrlIndex = 0;
            
            function loadWebGazer() {
                return new Promise((resolve, reject) => {
                    if (currentUrlIndex >= webgazerUrls.length) {
                        reject(new Error('ã™ã¹ã¦ã®WebGazer.js CDNã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = webgazerUrls[currentUrlIndex];
                    script.onload = () => {
                        console.log(`âœ… WebGazer.jsèª­ã¿è¾¼ã¿æˆåŠŸ: ${webgazerUrls[currentUrlIndex]}`);
                        resolve();
                    };
                    script.onerror = () => {
                        console.warn(`âš ï¸ WebGazer.jsèª­ã¿è¾¼ã¿å¤±æ•—: ${webgazerUrls[currentUrlIndex]}`);
                        currentUrlIndex++;
                        loadWebGazer().then(resolve).catch(reject);
                    };
                    document.head.appendChild(script);
                });
            }
            
            // WebGazer.jsèª­ã¿è¾¼ã¿é–‹å§‹
            window.webgazerPromise = loadWebGazer();
        })();
    </script>
    
    <!-- ãã®ä»–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Enhanced Styles -->
    <link rel="stylesheet" href="enhanced-styles.css">
    
    <style>
        /* Demo-specific styles */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            /* ğŸš¨ä¿®æ­£: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ç¢ºä¿ */
            overflow-y: auto;
            min-height: 100vh;
        }

        .demo-container {
            position: relative;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 50px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
            border-radius: 20px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ff00, #0080ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .feature-card h3 {
            color: #00ff00;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .feature-card p {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .demo-button {
            background: linear-gradient(45deg, #00ff00, #0080ff);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 255, 0, 0.3);
        }

        .interaction-demo {
            background: rgba(0, 0, 0, 0.3);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            text-align: center;
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }

        .status-indicator .status-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator .status-light {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-light.active {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .status-light.inactive {
            background: #ff0000;
        }

        .holographic-demo {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .code-lines {
            line-height: 1.8;
        }

        .code-line {
            opacity: 0;
            animation: codeAppear 0.5s ease forwards;
        }

        @keyframes codeAppear {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .emotion-demo {
            background: var(--primary-color);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.5s ease;
        }

        .emotion-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .emotion-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .emotion-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .particle-demo {
            height: 300px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
            cursor: pointer;
        }

        .particle-demo::before {
            content: 'Move your mouse here to interact with quantum particles';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            z-index: 1;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .control-group {
            margin: 15px 0;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .control-group input,
        .control-group select {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .control-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 11px;
            color: #00ff00;
            max-width: 300px;
            display: none;
        }

        .debug-mode .debug-info {
            display: block;
        }

        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .status-indicator {
                font-size: 10px;
                padding: 10px;
            }
        }
    </style>
</head>
<body class="quantum-field">
    <!-- Status Indicator -->
    <div class="status-indicator">
        <div class="status-item">
            Eye Tracking: <div class="status-light inactive" id="eye-status"></div>
        </div>
        <div class="status-item">
            Mouse Prediction: <div class="status-light inactive" id="mouse-status"></div>
        </div>
        <div class="status-item">
            Emotion Detection: <div class="status-light inactive" id="emotion-status"></div>
        </div>
        <div class="status-item">
            Quantum Particles: <div class="status-light inactive" id="particle-status"></div>
        </div>
        <div class="status-item">
            FPS: <span id="fps-display">0</span>
        </div>
    </div>

    <!-- Debug Information -->
    <div class="debug-info">
        <div>Mouse Position: <span id="mouse-pos">0, 0</span></div>
        <div>Gaze Position: <span id="gaze-pos">0, 0</span></div>
        <div>Current Emotion: <span id="current-emotion">trust</span></div>
        <div>Particle Count: <span id="particle-count">0</span></div>
        <div>Memory Usage: <span id="memory-usage">0MB</span></div>
    </div>

    <div class="demo-container">
        <!-- Header -->
        <header class="header neural-ui gaze-interactive">
            <h1>Enhanced IT Company</h1>
            <p>Experience the future of web interaction</p>
            <button class="demo-button gaze-interactive predictive-hover" onclick="toggleDebugMode()">
                Toggle Debug Mode
            </button>
        </header>

        <!-- Features Grid -->
        <div class="features-grid">
            <div class="feature-card gaze-interactive predictive-hover emotional-element">
                <h3>ğŸ‘ï¸ Eye Tracking</h3>
                <p>Revolutionary eye-tracking technology that responds to your gaze, creating intuitive navigation experiences.</p>
                <button class="demo-button" onclick="startEyeCalibration()">Calibrate Eye Tracking</button>
            </div>

            <div class="feature-card gaze-interactive predictive-hover emotional-element">
                <h3>ğŸ¯ Mouse Prediction</h3>
                <p>Advanced algorithms predict your mouse movements, providing seamless pre-loading and smooth interactions.</p>
                <button class="demo-button" onclick="toggleMousePrediction()">Test Prediction</button>
            </div>

            <div class="feature-card gaze-interactive predictive-hover emotional-element">
                <h3>ğŸ¨ Emotion Colors</h3>
                <p>Dynamic color schemes that adapt to your emotional state, creating personalized visual experiences.</p>
                <div class="emotion-buttons">
                    <button class="emotion-btn" onclick="changeEmotion('joy')">Joy</button>
                    <button class="emotion-btn" onclick="changeEmotion('trust')">Trust</button>
                    <button class="emotion-btn" onclick="changeEmotion('surprise')">Surprise</button>
                    <button class="emotion-btn" onclick="changeEmotion('anticipation')">Anticipation</button>
                </div>
            </div>

            <div class="feature-card gaze-interactive predictive-hover emotional-element">
                <h3>âš›ï¸ Quantum Particles</h3>
                <p>Beautiful particle physics simulation that responds to your interactions with quantum-inspired behaviors.</p>
                <button class="demo-button" onclick="addParticles()">Add Particles</button>
            </div>
        </div>

        <!-- Interactive Demos -->
        <div class="interaction-demo">
            <h2>Holographic Code Visualization</h2>
            <div class="holographic-demo holographic-code gaze-interactive">
                <div class="code-lines" id="code-display">
                    <div class="code-line">const futureTech = new InnovationEngine();</div>
                    <div class="code-line">futureTech.initialize({</div>
                    <div class="code-line">  eyeTracking: true,</div>
                    <div class="code-line">  emotionDetection: true,</div>
                    <div class="code-line">  quantumParticles: true</div>
                    <div class="code-line">});</div>
                    <div class="code-line">futureTech.createMagic();</div>
                </div>
            </div>
        </div>

        <div class="interaction-demo">
            <h2>Emotion-Responsive Theme</h2>
            <div class="emotion-demo" id="emotion-demo">
                <h3>Current Emotion: <span id="emotion-display">Trust</span></h3>
                <p>The background color changes based on detected or selected emotions</p>
            </div>
        </div>

        <div class="interaction-demo">
            <h2>Quantum Particle Interaction</h2>
            <div class="particle-demo" id="particle-demo">
                <!-- Quantum particles will be rendered here -->
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <h3>System Controls</h3>
            <div class="control-group">
                <label for="particle-count-slider">Particle Count:</label>
                <input type="range" id="particle-count-slider" min="50" max="500" value="200" onchange="updateParticleCount(this.value)">
            </div>
            <div class="control-group">
                <label for="animation-speed">Animation Speed:</label>
                <input type="range" id="animation-speed" min="0.1" max="2" step="0.1" value="1" onchange="updateAnimationSpeed(this.value)">
            </div>
            <div class="control-group">
                <label for="performance-mode">Performance Mode:</label>
                <select id="performance-mode" onchange="updatePerformanceMode(this.value)">
                    <option value="auto">Auto</option>
                    <option value="high">High Quality</option>
                    <option value="balanced">Balanced</option>
                    <option value="low">Low Resource</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Eye Tracking Implementation Script -->
    <script>
        // ğŸš¨ç·Šæ€¥ä¿®æ­£: å …ç‰¢ãªçœ¼çƒè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ 
        class RobustEyeTrackingSystem {
            constructor() {
                this.isInitialized = false;
                this.isCalibrating = false;
                this.calibrationPoints = [];
                this.currentPointIndex = 0;
                this.gazeData = [];
                this.calibrationAccuracy = 0;
                this.statusElement = null;
                this.progressElement = null;
                
                // ğŸš¨æ–°æ©Ÿèƒ½: ãƒ‡ãƒãƒƒã‚°ã¨è¨ºæ–­
                this.debugMode = window.location.hash === '#debug';
                this.initializationAttempts = 0;
                this.maxInitializationAttempts = 3;
                this.systemStatus = 'uninitialized';
                
                // ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
                this.browserSupport = this.checkBrowserSupport();
                
                this.log('ğŸ¯ RobustEyeTrackingSystemæ§‹ç¯‰å®Œäº†', 'info');
            }
            
            checkBrowserSupport() {
                const support = {
                    mediaDevices: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
                    webgl: !!window.WebGLRenderingContext,
                    https: window.location.protocol === 'https:' || window.location.hostname === 'localhost',
                    browser: this.detectBrowser()
                };
                
                this.log('ğŸ” ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆç¢ºèª:', 'info', support);
                return support;
            }
            
            detectBrowser() {
                const ua = navigator.userAgent;
                if (ua.includes('Chrome')) return 'Chrome';
                if (ua.includes('Firefox')) return 'Firefox';
                if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
                if (ua.includes('Edge')) return 'Edge';
                return 'Unknown';
            }
            
            log(message, type = 'info', data = null) {
                const timestamp = new Date().toISOString();
                const logMessage = `[${timestamp}] ${message}`;
                
                switch (type) {
                    case 'error':
                        console.error(logMessage, data || '');
                        break;
                    case 'warn':
                        console.warn(logMessage, data || '');
                        break;
                    case 'success':
                        console.log(`âœ… ${logMessage}`, data || '');
                        break;
                    default:
                        console.log(`â„¹ï¸ ${logMessage}`, data || '');
                }
                
                if (this.debugMode) {
                    this.updateDebugDisplay(logMessage, type);
                }
            }
            
            updateDebugDisplay(message, type) {
                let debugPanel = document.getElementById('debug-panel');
                if (!debugPanel) {
                    debugPanel = document.createElement('div');
                    debugPanel.id = 'debug-panel';
                    debugPanel.style.cssText = `
                        position: fixed;
                        bottom: 10px;
                        left: 10px;
                        width: 400px;
                        height: 200px;
                        background: rgba(0, 0, 0, 0.9);
                        color: white;
                        padding: 10px;
                        border-radius: 5px;
                        font-family: monospace;
                        font-size: 10px;
                        overflow-y: auto;
                        z-index: 10001;
                        border: 1px solid #333;
                    `;
                    document.body.appendChild(debugPanel);
                }
                
                const colors = {
                    error: '#ff4444',
                    warn: '#ffaa00',
                    success: '#44ff44',
                    info: '#4488ff'
                };
                
                const logEntry = document.createElement('div');
                logEntry.style.color = colors[type] || colors.info;
                logEntry.textContent = message;
                debugPanel.appendChild(logEntry);
                
                // æœ€æ–°ãƒ­ã‚°ã‚’è¡¨ç¤º
                debugPanel.scrollTop = debugPanel.scrollHeight;
                
                // 100è¡Œã‚’è¶…ãˆãŸã‚‰å¤ã„ãƒ­ã‚°ã‚’å‰Šé™¤
                if (debugPanel.children.length > 100) {
                    debugPanel.removeChild(debugPanel.firstChild);
                }
            }

            async initialize() {
                this.initializationAttempts++;
                this.systemStatus = 'initializing';
                
                try {
                    this.log(`ğŸ¯ WebGazer.jsåˆæœŸåŒ–é–‹å§‹ (è©¦è¡Œ ${this.initializationAttempts}/${this.maxInitializationAttempts})`, 'info');
                    
                    // å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
                    const prereqCheck = await this.checkPrerequisites();
                    if (!prereqCheck.success) {
                        throw new Error(`å‰ææ¡ä»¶ã‚¨ãƒ©ãƒ¼: ${prereqCheck.message}`);
                    }
                    
                    // WebGazer.jsåˆ©ç”¨å¯èƒ½æ€§ç¢ºèª
                    if (typeof webgazer === 'undefined') {
                        throw new Error('WebGazer.jsãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }
                    
                    this.log('WebGazer.jsåˆ©ç”¨å¯èƒ½æ€§ç¢ºèªå®Œäº†', 'success');
                    
                    // WebGazer.jsåˆæœŸåŒ– - ğŸš¨å®Œå…¨ä¿®æ­£ç‰ˆ
                    this.log('WebGazer.jsé–‹å§‹å‡¦ç†å®Ÿè¡Œä¸­...', 'info');
                    
                    // æ®µéšçš„åˆæœŸåŒ–
                    webgazer.setGazeListener((data, clock) => {
                        if (data && data.x && data.y) {
                            this.handleGazeData(data, clock);
                        }
                    });
                    
                    // WebGazeré–‹å§‹
                    await webgazer.begin();
                    
                    // å°‘ã—å¾…æ©Ÿã—ã¦ã‹ã‚‰è¨­å®šé©ç”¨
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // å®‰å…¨ãªè¨­å®šé©ç”¨
                    try {
                        // ãƒ“ãƒ‡ã‚ªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’éè¡¨ç¤º
                        const videoContainer = document.getElementById('webgazerVideoContainer');
                        if (videoContainer) {
                            videoContainer.style.display = 'none';
                        }
                        
                        // äºˆæ¸¬ç‚¹ã‚’éè¡¨ç¤º
                        const gazeDot = document.getElementById('webgazerGazeDot');
                        if (gazeDot) {
                            gazeDot.style.display = 'none';
                        }
                    } catch (settingsError) {
                        this.log('è¨­å®šã‚¨ãƒ©ãƒ¼ï¼ˆç¶™ç¶šå¯èƒ½ï¼‰', 'warn', settingsError.message);
                    }

                    this.isInitialized = true;
                    this.systemStatus = 'initialized';
                    this.updateStatus('WebGazer.jsåˆæœŸåŒ–å®Œäº†', 'success');
                    this.log('âœ… WebGazer.jsåˆæœŸåŒ–æˆåŠŸ', 'success');
                    
                    return true;
                } catch (error) {
                    this.systemStatus = 'error';
                    this.log(`âŒ WebGazer.jsåˆæœŸåŒ–å¤±æ•—: ${error.message}`, 'error');
                    
                    // ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
                    if (this.initializationAttempts < this.maxInitializationAttempts) {
                        this.log(`ğŸ”„ ${2}ç§’å¾Œã«å†è©¦è¡Œã—ã¾ã™...`, 'warn');
                        await this.delay(2000);
                        return this.initialize();
                    } else {
                        this.updateStatus(`åˆæœŸåŒ–å¤±æ•—: ${error.message}`, 'error');
                        this.showFallbackOptions();
                        return false;
                    }
                }
            }
            
            async checkPrerequisites() {
                const checks = [];
                
                // HTTPS/localhost ãƒã‚§ãƒƒã‚¯
                if (!this.browserSupport.https) {
                    checks.push('HTTPSæ¥ç¶šã¾ãŸã¯localhostãŒå¿…è¦ã§ã™');
                }
                
                // MediaDevices API ãƒã‚§ãƒƒã‚¯
                if (!this.browserSupport.mediaDevices) {
                    checks.push('ã‚«ãƒ¡ãƒ©APIãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // WebGL ãƒã‚§ãƒƒã‚¯
                if (!this.browserSupport.webgl) {
                    checks.push('WebGLãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // WebGazer.js CDNèª­ã¿è¾¼ã¿ç¢ºèª
                try {
                    await window.webgazerPromise;
                    this.log('WebGazer.js CDNèª­ã¿è¾¼ã¿ç¢ºèªå®Œäº†', 'success');
                } catch (error) {
                    checks.push(`WebGazer.jsèª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`);
                }
                
                return {
                    success: checks.length === 0,
                    message: checks.join(', ')
                };
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            showFallbackOptions() {
                const fallbackOverlay = document.createElement('div');
                fallbackOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.95);
                    z-index: 10000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    color: white;
                    font-family: Arial, sans-serif;
                    overflow-y: auto;
                `;
                
                const isHTTPS = window.location.protocol === 'https:';
                const isLocalhost = window.location.hostname === 'localhost';
                const isFile = window.location.protocol === 'file:';
                
                fallbackOverlay.innerHTML = `
                    <div style="text-align: center; max-width: 700px; padding: 40px; margin: 20px;">
                        <h2 style="color: #ffaa00;">ğŸ”’ HTTPSç’°å¢ƒãŒå¿…è¦ã§ã™</h2>
                        
                        <div style="margin: 20px 0; padding: 25px; background: rgba(255, 170, 0, 0.1); border-radius: 15px; text-align: left; border-left: 4px solid #ffaa00;">
                            <h3 style="color: #ffaa00; margin-top: 0;">ğŸ“‹ æ ¹æœ¬åŸå› </h3>
                            <p><strong>çœ¼çƒè¿½è·¡æ©Ÿèƒ½ã«ã¯ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚</strong></p>
                            <p>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶ç´„ã«ã‚ˆã‚Šã€ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã¯<strong>HTTPSç’°å¢ƒ</strong>ã¾ãŸã¯<strong>localhost</strong>ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚</p>
                            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>ç¾åœ¨ã®ç’°å¢ƒ:</strong> ${window.location.protocol}//${window.location.hostname}<br>
                                <strong>HTTPS:</strong> ${isHTTPS ? 'âœ… å¯¾å¿œ' : 'âŒ æœªå¯¾å¿œ'}<br>
                                <strong>Localhost:</strong> ${isLocalhost ? 'âœ… å¯¾å¿œ' : 'âŒ æœªå¯¾å¿œ'}<br>
                                <strong>File://:</strong> ${isFile ? 'âš ï¸ ã‚«ãƒ¡ãƒ©åˆ©ç”¨ä¸å¯' : 'âœ… å•é¡Œãªã—'}
                            </div>
                        </div>
                        
                        <div style="margin: 20px 0; padding: 25px; background: rgba(76, 175, 80, 0.1); border-radius: 15px; text-align: left; border-left: 4px solid #4CAF50;">
                            <h3 style="color: #4CAF50; margin-top: 0;">ğŸš€ è§£æ±ºæ–¹æ³•</h3>
                            
                            <h4>ğŸ“± ã™ãã«è©¦ã›ã‚‹æ–¹æ³•:</h4>
                            <ol>
                                <li><strong>ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</strong> (æ¨å¥¨)
                                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin: 8px 0; font-family: monospace;">
                                        # Python 3ã®å ´åˆ<br>
                                        python -m http.server 8000<br><br>
                                        # Python 2ã®å ´åˆ<br>
                                        python -m SimpleHTTPServer 8000<br><br>
                                        # Node.jsã®å ´åˆ<br>
                                        npx http-server
                                    </div>
                                    ãã®å¾Œ <code>http://localhost:8000</code> ã§ã‚¢ã‚¯ã‚»ã‚¹
                                </li>
                                
                                <li><strong>ç„¡æ–™HTTPSç’°å¢ƒã‚’åˆ©ç”¨</strong>
                                    <ul>
                                        <li><a href="https://pages.github.com/" target="_blank" style="color: #4CAF50;">GitHub Pages</a> - ç„¡æ–™ã§HTTPSå¯¾å¿œ</li>
                                        <li><a href="https://netlify.com/" target="_blank" style="color: #4CAF50;">Netlify</a> - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                                        <li><a href="https://vercel.com/" target="_blank" style="color: #4CAF50;">Vercel</a> - é«˜é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤</li>
                                    </ul>
                                </li>
                            </ol>
                            
                            <h4>ğŸ­ ä»£æ›¿ä½“é¨“:</h4>
                            <p>çœ¼çƒè¿½è·¡ãŒåˆ©ç”¨ã§ããªã„å ´åˆã§ã‚‚ã€<strong>ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æ©Ÿèƒ½</strong>ã§Webã‚µã‚¤ãƒˆã®é©æ–°çš„ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½“é¨“ã§ãã¾ã™ï¼</p>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button onclick="enableMouseTrackingMode()" style="
                                background: linear-gradient(45deg, #4CAF50, #45a049);
                                border: none;
                                padding: 15px 30px;
                                border-radius: 25px;
                                color: white;
                                font-size: 16px;
                                font-weight: bold;
                                cursor: pointer;
                                margin: 10px;
                                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
                            ">ğŸ–±ï¸ ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã§ä½“é¨“</button>
                            
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                background: #666;
                                border: none;
                                padding: 15px 30px;
                                border-radius: 25px;
                                color: white;
                                font-size: 16px;
                                cursor: pointer;
                                margin: 10px;
                            ">é–‰ã˜ã‚‹</button>
                            
                            <button onclick="copyLocalServerCommand()" style="
                                background: #2196F3;
                                border: none;
                                padding: 15px 30px;
                                border-radius: 25px;
                                color: white;
                                font-size: 16px;
                                cursor: pointer;
                                margin: 10px;
                            ">ğŸ“‹ ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(fallbackOverlay);
            }
            
            // ğŸš¨æ–°æ©Ÿèƒ½: ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰
            enableMouseTrackingMode() {
                console.log('ğŸ–±ï¸ ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰é–‹å§‹');
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»é¢ã‚’é–‰ã˜ã‚‹
                const overlay = document.querySelector('[style*="position: fixed"]');
                if (overlay) overlay.remove();
                
                // ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
                this.initializeMouseTracking();
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
                this.updateStatus('ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ', 'success');
                document.getElementById('eye-status').className = 'status-light active';
            }
            
            initializeMouseTracking() {
                let mouseTrackingActive = true;
                
                // ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°è¡¨ç¤º
                const tracker = document.createElement('div');
                tracker.id = 'mouse-tracker';
                tracker.style.cssText = `
                    position: fixed;
                    width: 15px;
                    height: 15px;
                    background: radial-gradient(circle, #00ff00, #0080ff);
                    border: 2px solid rgba(255, 255, 255, 0.8);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 9999;
                    transition: all 0.1s ease;
                    box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
                `;
                document.body.appendChild(tracker);
                
                // ãƒã‚¦ã‚¹è¿½è·¡
                document.addEventListener('mousemove', (e) => {
                    if (!mouseTrackingActive) return;
                    
                    tracker.style.left = (e.clientX - 7) + 'px';
                    tracker.style.top = (e.clientY - 7) + 'px';
                    
                    // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ ã¨ã®ç›¸äº’ä½œç”¨
                    const elements = document.elementsFromPoint(e.clientX, e.clientY);
                    elements.forEach(element => {
                        if (element.classList.contains('gaze-interactive') || 
                            element.classList.contains('predictive-hover')) {
                            this.triggerMouseEffect(element);
                        }
                    });
                });
                
                // æƒ…å ±ãƒ‘ãƒãƒ«è¡¨ç¤º
                this.showMouseTrackingInfo();
            }
            
            triggerMouseEffect(element) {
                element.style.transition = 'all 0.3s ease';
                element.style.transform = 'scale(1.02)';
                element.style.boxShadow = '0 0 15px rgba(0, 255, 0, 0.4)';
                
                setTimeout(() => {
                    element.style.transform = '';
                    element.style.boxShadow = '';
                }, 500);
            }
            
            showMouseTrackingInfo() {
                const infoPanel = document.createElement('div');
                infoPanel.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: #00ff00;
                    padding: 15px;
                    border-radius: 10px;
                    font-family: monospace;
                    font-size: 12px;
                    z-index: 1001;
                    border: 1px solid #00ff00;
                `;
                
                infoPanel.innerHTML = `
                    <strong>ğŸ–±ï¸ ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æœ‰åŠ¹</strong><br>
                    ãƒ»ãƒã‚¦ã‚¹ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä½“é¨“<br>
                    ãƒ»è¦ç´ ã«ãƒ›ãƒãƒ¼ã§åå¿œ<br>
                    ãƒ»çœ¼çƒè¿½è·¡ã®ä»£æ›¿æ©Ÿèƒ½<br>
                    <button onclick="this.parentElement.remove()" style="
                        background: #00ff00;
                        border: none;
                        color: black;
                        padding: 5px 10px;
                        border-radius: 3px;
                        cursor: pointer;
                        margin-top: 10px;
                        font-size: 10px;
                    ">é–‰ã˜ã‚‹</button>
                `;
                
                document.body.appendChild(infoPanel);
            }
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒãƒ³ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
            copyLocalServerCommand() {
                const command = 'python -m http.server 8000';
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(command).then(() => {
                        alert('ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    });
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    const textArea = document.createElement('textarea');
                    textArea.value = command;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                }
            }

            handleGazeData(data, clock) {
                this.gazeData.push({
                    x: data.x,
                    y: data.y,
                    timestamp: clock
                });

                // ãƒ‡ãƒ¼ã‚¿ã‚’æœ€æ–°100ä»¶ã«åˆ¶é™
                if (this.gazeData.length > 100) {
                    this.gazeData.shift();
                }

                // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºæ›´æ–°
                if (document.getElementById('gaze-pos')) {
                    document.getElementById('gaze-pos').textContent = `${Math.round(data.x)}, ${Math.round(data.y)}`;
                }

                // æ ¡æ­£ä¸­ã®å ´åˆã€è¦–ç·šä½ç½®ã‚’è¡¨ç¤º
                if (this.isCalibrating) {
                    this.showGazeIndicator(data.x, data.y);
                }
            }

            showGazeIndicator(x, y) {
                let indicator = document.getElementById('gaze-indicator');
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.id = 'gaze-indicator';
                    indicator.style.cssText = `
                        position: fixed;
                        width: 20px;
                        height: 20px;
                        background: rgba(255, 0, 0, 0.7);
                        border: 2px solid #fff;
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 10001;
                        transition: all 0.1s ease;
                    `;
                    document.body.appendChild(indicator);
                }

                indicator.style.left = (x - 10) + 'px';
                indicator.style.top = (y - 10) + 'px';
            }

            async startCalibration() {
                if (!this.isInitialized) {
                    const initialized = await this.initialize();
                    if (!initialized) return;
                }

                this.updateStatus('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ç¢ºèªä¸­...', 'warning');
                
                try {
                    // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ç¢ºèª
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    stream.getTracks().forEach(track => track.stop()); // ä¸€æ™‚çš„ãªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                    
                    this.updateStatus('æ ¡æ­£ã‚’é–‹å§‹ã—ã¾ã™', 'info');
                    this.isCalibrating = true;
                    
                    // æ ¡æ­£ãƒã‚¤ãƒ³ãƒˆã®è¨­å®šï¼ˆ9ç‚¹æ ¡æ­£ï¼‰
                    this.calibrationPoints = [
                        { x: window.innerWidth * 0.1, y: window.innerHeight * 0.1 },   // å·¦ä¸Š
                        { x: window.innerWidth * 0.5, y: window.innerHeight * 0.1 },   // ä¸­ä¸Š
                        { x: window.innerWidth * 0.9, y: window.innerHeight * 0.1 },   // å³ä¸Š
                        { x: window.innerWidth * 0.1, y: window.innerHeight * 0.5 },   // å·¦ä¸­
                        { x: window.innerWidth * 0.5, y: window.innerHeight * 0.5 },   // ä¸­å¤®
                        { x: window.innerWidth * 0.9, y: window.innerHeight * 0.5 },   // å³ä¸­
                        { x: window.innerWidth * 0.1, y: window.innerHeight * 0.9 },   // å·¦ä¸‹
                        { x: window.innerWidth * 0.5, y: window.innerHeight * 0.9 },   // ä¸­ä¸‹
                        { x: window.innerWidth * 0.9, y: window.innerHeight * 0.9 }    // å³ä¸‹
                    ];
                    
                    this.currentPointIndex = 0;
                    this.showCalibrationInterface();
                    
                } catch (error) {
                    console.error('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateStatus('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
                    this.showCameraPermissionHelp();
                }
            }

            showCalibrationInterface() {
                // æ—¢å­˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
                const existingOverlay = document.getElementById('calibration-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }

                // æ ¡æ­£ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ä½œæˆ
                const overlay = document.createElement('div');
                overlay.id = 'calibration-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    color: white;
                    font-family: Arial, sans-serif;
                `;

                // æŒ‡ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
                const instruction = document.createElement('div');
                instruction.style.cssText = `
                    position: absolute;
                    top: 50px;
                    left: 50%;
                    transform: translateX(-50%);
                    text-align: center;
                    font-size: 24px;
                    color: #00ff00;
                `;
                instruction.innerHTML = `
                    <h2>ğŸ‘ï¸ çœ¼çƒè¿½è·¡æ ¡æ­£</h2>
                    <p>èµ¤ã„ç‚¹ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€ãã®ç‚¹ã‚’è¦‹ã¤ã‚ã¦ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
                    <p>é€²æ—: <span id="calibration-progress">0/${this.calibrationPoints.length}</span></p>
                `;
                overlay.appendChild(instruction);

                // é€²æ—è¦ç´ ã®ä¿å­˜
                this.progressElement = instruction.querySelector('#calibration-progress');

                document.body.appendChild(overlay);
                this.showNextCalibrationPoint();
            }

            showNextCalibrationPoint() {
                if (this.currentPointIndex >= this.calibrationPoints.length) {
                    this.completeCalibration();
                    return;
                }

                const point = this.calibrationPoints[this.currentPointIndex];
                const overlay = document.getElementById('calibration-overlay');
                
                // æ—¢å­˜ã®ç‚¹ã‚’å‰Šé™¤
                const existingDot = overlay.querySelector('.calibration-dot');
                if (existingDot) {
                    existingDot.remove();
                }

                // æ–°ã—ã„æ ¡æ­£ç‚¹ã‚’ä½œæˆ
                const dot = document.createElement('div');
                dot.className = 'calibration-dot';
                dot.style.cssText = `
                    position: absolute;
                    width: 20px;
                    height: 20px;
                    background: #ff0000;
                    border: 3px solid #ffffff;
                    border-radius: 50%;
                    left: ${point.x - 10}px;
                    top: ${point.y - 10}px;
                    cursor: pointer;
                    animation: calibrationPulse 1s infinite;
                    box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
                `;

                // CSS ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
                if (!document.getElementById('calibration-styles')) {
                    const style = document.createElement('style');
                    style.id = 'calibration-styles';
                    style.textContent = `
                        @keyframes calibrationPulse {
                            0%, 100% { transform: scale(1); opacity: 1; }
                            50% { transform: scale(1.3); opacity: 0.7; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                dot.onclick = () => {
                    // WebGazer.jsã«æ ¡æ­£ç‚¹ã‚’ç™»éŒ²
                    webgazer.recordScreenPosition(point.x, point.y, 'click');
                    
                    this.currentPointIndex++;
                    this.updateProgress();
                    
                    // æ¬¡ã®ç‚¹ã«é€²ã‚€
                    setTimeout(() => {
                        this.showNextCalibrationPoint();
                    }, 500);
                };

                overlay.appendChild(dot);
                this.updateProgress();
            }

            updateProgress() {
                if (this.progressElement) {
                    this.progressElement.textContent = `${this.currentPointIndex}/${this.calibrationPoints.length}`;
                }
            }

            async completeCalibration() {
                this.isCalibrating = false;
                
                // æ ¡æ­£ç²¾åº¦ã®è¨ˆç®—
                await this.calculateAccuracy();
                
                const overlay = document.getElementById('calibration-overlay');
                overlay.innerHTML = `
                    <div style="text-align: center; color: #00ff00;">
                        <h2>âœ… æ ¡æ­£å®Œäº†!</h2>
                        <p>ç²¾åº¦: ${this.calibrationAccuracy}%</p>
                        <p>çœ¼çƒè¿½è·¡ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ</p>
                        <button onclick="eyeTracker.finishCalibration()" style="
                            background: linear-gradient(45deg, #00ff00, #0080ff);
                            border: none;
                            padding: 15px 30px;
                            border-radius: 25px;
                            color: white;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            margin-top: 20px;
                        ">ç¶šè¡Œ</button>
                    </div>
                `;

                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                this.updateStatus(`æ ¡æ­£å®Œäº† (ç²¾åº¦: ${this.calibrationAccuracy}%)`, 'success');
                document.getElementById('eye-status').className = 'status-light active';
            }

            async calculateAccuracy() {
                try {
                    // ç°¡å˜ãªç²¾åº¦è¨ˆç®— (å®Ÿéš›ã®å®Ÿè£…ã§ã¯æ›´ã«è©³ç´°ãªè¨ˆç®—ãŒå¿…è¦)
                    const recentGazeData = this.gazeData.slice(-10);
                    if (recentGazeData.length > 0) {
                        const variance = this.calculateVariance(recentGazeData);
                        this.calibrationAccuracy = Math.max(20, Math.min(95, 95 - variance / 10));
                    } else {
                        this.calibrationAccuracy = 75; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                    }
                    this.calibrationAccuracy = Math.round(this.calibrationAccuracy);
                } catch (error) {
                    console.error('ç²¾åº¦è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                    this.calibrationAccuracy = 70;
                }
            }

            calculateVariance(data) {
                if (data.length === 0) return 100;
                
                const avgX = data.reduce((sum, point) => sum + point.x, 0) / data.length;
                const avgY = data.reduce((sum, point) => sum + point.y, 0) / data.length;
                
                const variance = data.reduce((sum, point) => {
                    return sum + Math.pow(point.x - avgX, 2) + Math.pow(point.y - avgY, 2);
                }, 0) / data.length;
                
                return Math.sqrt(variance);
            }

            finishCalibration() {
                const overlay = document.getElementById('calibration-overlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.remove();
                        // è¦–ç·šã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
                        const indicator = document.getElementById('gaze-indicator');
                        if (indicator) indicator.remove();
                    }, 500);
                }
                
                // æ ¡æ­£ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‰Šé™¤
                const styles = document.getElementById('calibration-styles');
                if (styles) styles.remove();
                
                this.updateStatus('çœ¼çƒè¿½è·¡ãŒæœ‰åŠ¹ã§ã™', 'success');
            }

            showCameraPermissionHelp() {
                const helpOverlay = document.createElement('div');
                helpOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    color: white;
                    font-family: Arial, sans-serif;
                `;
                
                helpOverlay.innerHTML = `
                    <div style="text-align: center; max-width: 500px; padding: 40px;">
                        <h2 style="color: #ff6b6b;">ğŸ“· ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™</h2>
                        <p>çœ¼çƒè¿½è·¡æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Webã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚</p>
                        <div style="margin: 20px 0; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                            <h3>æ‰‹é †:</h3>
                            <ol style="text-align: left;">
                                <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«ã‚ã‚‹ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                                <li>ã€Œè¨±å¯ã€ã¾ãŸã¯ã€ŒAllowã€ã‚’é¸æŠ</li>
                                <li>ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿</li>
                                <li>å†åº¦ã€ŒCalibrate Eye Trackingã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>
                            </ol>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: #ff6b6b;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 20px;
                            color: white;
                            cursor: pointer;
                            margin-top: 20px;
                        ">é–‰ã˜ã‚‹</button>
                    </div>
                `;
                
                document.body.appendChild(helpOverlay);
            }

            updateStatus(message, type = 'info') {
                console.log(`ğŸ¯ [${type.toUpperCase()}] ${message}`);
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã®æ›´æ–°
                if (!this.statusElement) {
                    this.statusElement = document.createElement('div');
                    this.statusElement.id = 'eye-tracking-status';
                    this.statusElement.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 20px;
                        background: rgba(0, 0, 0, 0.9);
                        color: white;
                        padding: 10px 15px;
                        border-radius: 5px;
                        font-family: monospace;
                        font-size: 12px;
                        z-index: 1001;
                        max-width: 300px;
                        word-wrap: break-word;
                    `;
                    document.body.appendChild(this.statusElement);
                }

                const colors = {
                    info: '#00bfff',
                    success: '#00ff00',
                    warning: '#ffa500',
                    error: '#ff6b6b'
                };

                this.statusElement.style.borderLeft = `4px solid ${colors[type] || colors.info}`;
                this.statusElement.textContent = message;

                // 5ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆå»ï¼ˆã‚¨ãƒ©ãƒ¼ä»¥å¤–ï¼‰
                if (type !== 'error') {
                    setTimeout(() => {
                        if (this.statusElement && this.statusElement.textContent === message) {
                            this.statusElement.style.opacity = '0';
                            setTimeout(() => {
                                if (this.statusElement) {
                                    this.statusElement.remove();
                                    this.statusElement = null;
                                }
                            }, 300);
                        }
                    }, 5000);
                }
            }

            // æ‰‹å‹•ã§åœæ­¢ã™ã‚‹å ´åˆ
            stop() {
                if (webgazer.isReady()) {
                    webgazer.end();
                }
                this.isInitialized = false;
                this.isCalibrating = false;
                
                // UIè¦ç´ ã®å‰Šé™¤
                const overlay = document.getElementById('calibration-overlay');
                if (overlay) overlay.remove();
                
                const indicator = document.getElementById('gaze-indicator');
                if (indicator) indicator.remove();
                
                if (this.statusElement) {
                    this.statusElement.remove();
                    this.statusElement = null;
                }
                
                this.updateStatus('çœ¼çƒè¿½è·¡ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info');
            }
        }

        // ğŸš¨ç·Šæ€¥ä¿®æ­£: å …ç‰¢ãªã‚°ãƒ­ãƒ¼ãƒãƒ«åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ 
        let robustEyeTracker = null;
        let systemInitialized = false;
        
        // å®Œå…¨åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ 
        async function initializeRobustSystem() {
            try {
                console.log('ğŸš€ å …ç‰¢ãªçœ¼çƒè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...');
                
                // WebGazer.jsèª­ã¿è¾¼ã¿å¾…æ©Ÿ
                await window.webgazerPromise;
                
                // ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
                robustEyeTracker = new RobustEyeTrackingSystem();
                
                // åˆæœŸåŒ–çŠ¶æ…‹æ›´æ–°
                systemInitialized = true;
                
                console.log('âœ… å …ç‰¢ãªçœ¼çƒè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°
                updateSystemStatus('ready', 'çœ¼çƒè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
                
            } catch (error) {
                console.error('âŒ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—:', error);
                systemInitialized = false;
                updateSystemStatus('error', `ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—: ${error.message}`);
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°
        function updateSystemStatus(status, message) {
            const statusElement = document.getElementById('eye-status');
            if (statusElement) {
                statusElement.className = status === 'ready' ? 'status-light active' : 'status-light inactive';
            }
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã®è©³ç´°è¡¨ç¤º
            if (window.location.hash === '#debug') {
                console.log(`ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: ${status} - ${message}`);
            }
        }

        // æ ¡æ­£é–‹å§‹é–¢æ•°ï¼ˆãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼‰
        async function startEyeCalibration() {
            try {
                console.log('ğŸ‘ï¸ çœ¼çƒè¿½è·¡æ ¡æ­£é–‹å§‹è¦æ±‚...');
                
                if (!systemInitialized) {
                    console.log('â³ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
                    updateSystemStatus('initializing', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
                    await initializeRobustSystem();
                }
                
                if (robustEyeTracker && systemInitialized) {
                    await robustEyeTracker.startCalibration();
                } else {
                    throw new Error('çœ¼çƒè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
            } catch (error) {
                console.error('âŒ æ ¡æ­£é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const errorOverlay = document.createElement('div');
                errorOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 10000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    color: white;
                    font-family: Arial, sans-serif;
                `;
                
                errorOverlay.innerHTML = `
                    <div style="text-align: center; max-width: 500px; padding: 40px; background: rgba(255, 255, 255, 0.1); border-radius: 20px;">
                        <h2 style="color: #ff6b6b;">ğŸš¨ çœ¼çƒè¿½è·¡ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸ</h2>
                        <p style="margin: 20px 0; line-height: 1.6;">${error.message}</p>
                        <div style="margin-top: 30px;">
                            <button onclick="location.reload()" style="
                                background: #4CAF50;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 20px;
                                color: white;
                                cursor: pointer;
                                margin: 10px;
                            ">ğŸ”„ å†èª­ã¿è¾¼ã¿</button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                background: #ff6b6b;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 20px;
                                color: white;
                                cursor: pointer;
                                margin: 10px;
                            ">âŒ é–‰ã˜ã‚‹</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(errorOverlay);
            }
        }
        
        // ğŸš¨æ–°æ©Ÿèƒ½: ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦ä»£æ›¿æ©Ÿèƒ½ã‚’å®šç¾©
        window.enableMouseTrackingMode = function() {
            console.log('ğŸ–±ï¸ ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰é–‹å§‹');
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»é¢ã‚’é–‰ã˜ã‚‹
            const overlays = document.querySelectorAll('[style*="position: fixed"]');
            overlays.forEach(overlay => {
                if (overlay.style.zIndex >= 10000) overlay.remove();
            });
            
            // ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
            initializeMouseTracking();
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            updateSystemStatus('ready', 'ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹');
        };
        
        window.copyLocalServerCommand = function() {
            const command = 'python -m http.server 8000';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(command).then(() => {
                    alert('âœ… ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š\n' + command + '\n\nãã®å¾Œ http://localhost:8000 ã§ã‚¢ã‚¯ã‚»ã‚¹');
                }).catch(() => {
                    fallbackCopy(command);
                });
            } else {
                fallbackCopy(command);
            }
            
            function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š\n' + text + '\n\nãã®å¾Œ http://localhost:8000 ã§ã‚¢ã‚¯ã‚»ã‚¹');
            }
        };
        
        function initializeMouseTracking() {
            // æ—¢å­˜ã®ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã‚’å‰Šé™¤
            const existingTracker = document.getElementById('mouse-tracker');
            if (existingTracker) existingTracker.remove();
            
            let mouseTrackingActive = true;
            
            // ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°è¡¨ç¤º
            const tracker = document.createElement('div');
            tracker.id = 'mouse-tracker';
            tracker.style.cssText = `
                position: fixed;
                width: 15px;
                height: 15px;
                background: radial-gradient(circle, #00ff00, #0080ff);
                border: 2px solid rgba(255, 255, 255, 0.8);
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                transition: all 0.1s ease;
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
            `;
            document.body.appendChild(tracker);
            
            // ãƒã‚¦ã‚¹è¿½è·¡
            document.addEventListener('mousemove', (e) => {
                if (!mouseTrackingActive) return;
                
                tracker.style.left = (e.clientX - 7) + 'px';
                tracker.style.top = (e.clientY - 7) + 'px';
                
                // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ ã¨ã®ç›¸äº’ä½œç”¨
                const elements = document.elementsFromPoint(e.clientX, e.clientY);
                elements.forEach(element => {
                    if (element.classList.contains('gaze-interactive') || 
                        element.classList.contains('predictive-hover')) {
                        triggerMouseEffect(element);
                    }
                });
            });
            
            // æƒ…å ±ãƒ‘ãƒãƒ«è¡¨ç¤º
            showMouseTrackingInfo();
        }
        
        function triggerMouseEffect(element) {
            element.style.transition = 'all 0.3s ease';
            element.style.transform = 'scale(1.02)';
            element.style.boxShadow = '0 0 15px rgba(0, 255, 0, 0.4)';
            
            setTimeout(() => {
                element.style.transform = '';
                element.style.boxShadow = '';
            }, 500);
        }
        
        function showMouseTrackingInfo() {
            // æ—¢å­˜ã®æƒ…å ±ãƒ‘ãƒãƒ«ã‚’å‰Šé™¤
            const existingPanel = document.querySelector('#mouse-tracking-info');
            if (existingPanel) existingPanel.remove();
            
            const infoPanel = document.createElement('div');
            infoPanel.id = 'mouse-tracking-info';
            infoPanel.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: rgba(0, 0, 0, 0.9);
                color: #00ff00;
                padding: 15px;
                border-radius: 10px;
                font-family: Arial, sans-serif;
                font-size: 12px;
                z-index: 1001;
                border: 1px solid #00ff00;
                box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            `;
            
            infoPanel.innerHTML = `
                <strong>ğŸ–±ï¸ ãƒã‚¦ã‚¹ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æœ‰åŠ¹</strong><br>
                ãƒ»ãƒã‚¦ã‚¹ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä½“é¨“ä¸­<br>
                ãƒ»è¦ç´ ã«ãƒ›ãƒãƒ¼ã™ã‚‹ã¨åå¿œã—ã¾ã™<br>
                ãƒ»çœ¼çƒè¿½è·¡ã®ä»£æ›¿æ©Ÿèƒ½ã¨ã—ã¦å‹•ä½œ<br>
                <button onclick="this.parentElement.remove()" style="
                    background: #00ff00;
                    border: none;
                    color: black;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    margin-top: 10px;
                    font-size: 10px;
                    font-weight: bold;
                ">é–‰ã˜ã‚‹</button>
            `;
            
            document.body.appendChild(infoPanel);
            
            // 10ç§’å¾Œã«è‡ªå‹•ã§é–‰ã˜ã‚‹
            setTimeout(() => {
                if (infoPanel.parentElement) {
                    infoPanel.style.opacity = '0';
                    setTimeout(() => {
                        if (infoPanel.parentElement) infoPanel.remove();
                    }, 300);
                }
            }, 10000);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«è‡ªå‹•åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ DOMèª­ã¿è¾¼ã¿å®Œäº† - è‡ªå‹•åˆæœŸåŒ–é–‹å§‹');
            setTimeout(initializeRobustSystem, 1000); // 1ç§’å¾Œã«åˆæœŸåŒ–é–‹å§‹
        });

        // ãã®ä»–ã®ãƒ‡ãƒ¢æ©Ÿèƒ½ã¯æ—¢å­˜ã®ã¾ã¾ä¿æŒ
        function toggleMousePrediction() {
            document.body.style.cursor = 'crosshair';
            setTimeout(() => {
                document.body.style.cursor = 'default';
            }, 3000);
        }

        function changeEmotion(emotion) {
            document.getElementById('emotion-display').textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
        }

        function addParticles() {
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«è¿½åŠ ï¼ˆãƒ‡ãƒ¢ï¼‰');
        }

        function updateParticleCount(count) {
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°æ›´æ–°:', count);
        }

        function updateAnimationSpeed(speed) {
            document.documentElement.style.setProperty('--animation-speed', `${speed}s`);
        }

        function updatePerformanceMode(mode) {
            document.body.className = document.body.className.replace(/\b(high|low|balanced)-performance\b/g, '');
            if (mode !== 'auto') {
                document.body.classList.add(`${mode}-performance`);
            }
        }

        function toggleDebugMode() {
            document.body.classList.toggle('debug-mode');
        }

        // ãƒšãƒ¼ã‚¸ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (eyeTracker) {
                eyeTracker.stop();
            }
        });
    </script>

    <!-- Demo Control Script -->
    <script>
        // Demo-specific functionality
        let debugMode = false;
        let enhancedSystem = null;

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Animate code lines
            animateCodeLines();
            
            // Update status indicators
            updateStatusIndicators();
        });

        function animateCodeLines() {
            const codeLines = document.querySelectorAll('.code-line');
            codeLines.forEach((line, index) => {
                line.style.animationDelay = `${index * 0.2}s`;
            });
        }

        function updateStatusIndicators() {
            // Simulate status updates
            setTimeout(() => {
                document.getElementById('mouse-status').className = 'status-light active';
            }, 1000);
            
            setTimeout(() => {
                document.getElementById('particle-status').className = 'status-light active';
            }, 2000);
            
            setTimeout(() => {
                document.getElementById('emotion-status').className = 'status-light active';
            }, 3000);
        }

        // Enhanced system initialization removed - using direct WebGazer.js implementation

        function toggleDebugMode() {
            debugMode = !debugMode;
            document.body.classList.toggle('debug-mode', debugMode);
            
            if (debugMode) {
                startDebugUpdates();
            }
        }

        function startDebugUpdates() {
            setInterval(() => {
                if (debugMode) {
                    updateDebugInfo();
                }
            }, 100);
        }

        function updateDebugInfo() {
            const mousePos = document.getElementById('mouse-pos');
            const gazePos = document.getElementById('gaze-pos');
            const currentEmotion = document.getElementById('current-emotion');
            const particleCount = document.getElementById('particle-count');
            const memoryUsage = document.getElementById('memory-usage');

            // Update with actual values if available
            if (performance.memory) {
                memoryUsage.textContent = `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB`;
            }
        }

        // Duplicate function removed - using main implementation above

        function toggleMousePrediction() {
            // Demo mouse prediction
            document.body.style.cursor = 'crosshair';
            setTimeout(() => {
                document.body.style.cursor = 'default';
            }, 3000);
        }

        function changeEmotion(emotion) {
            document.getElementById('emotion-display').textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
            
            // Trigger emotion change event
            const event = new CustomEvent('emotionChange', {
                detail: { emotion: emotion }
            });
            document.dispatchEvent(event);
        }

        function addParticles() {
            const event = new CustomEvent('addParticles', {
                detail: { count: 50 }
            });
            document.dispatchEvent(event);
        }

        function updateParticleCount(count) {
            const event = new CustomEvent('updateParticleCount', {
                detail: { count: parseInt(count) }
            });
            document.dispatchEvent(event);
        }

        function updateAnimationSpeed(speed) {
            document.documentElement.style.setProperty('--animation-speed', `${speed}s`);
        }

        function updatePerformanceMode(mode) {
            document.body.className = document.body.className.replace(/\b(high|low|balanced)-performance\b/g, '');
            
            if (mode !== 'auto') {
                document.body.classList.add(`${mode}-performance`);
            }
        }

        // Track mouse position for debug
        document.addEventListener('mousemove', (e) => {
            if (debugMode) {
                document.getElementById('mouse-pos').textContent = `${e.clientX}, ${e.clientY}`;
            }
        });

        // FPS Counter
        let frameCount = 0;
        let lastTime = Date.now();

        function updateFPS() {
            frameCount++;
            const now = Date.now();
            
            if (now - lastTime >= 1000) {
                document.getElementById('fps-display').textContent = frameCount;
                frameCount = 0;
                lastTime = now;
            }
            
            requestAnimationFrame(updateFPS);
        }
        updateFPS();

        // Performance monitoring
        if (performance.memory) {
            setInterval(() => {
                const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
                if (memoryMB > 100) {
                    document.body.classList.add('high-memory');
                } else {
                    document.body.classList.remove('high-memory');
                }
            }, 5000);
        }
    </script>
</body>
</html>